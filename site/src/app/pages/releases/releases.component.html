<ng-container *ngIf="latestOnly; else fullReleases">
    <latest-releases [releases]="latestReleases" [loading]="loading" [error]="error"></latest-releases>
</ng-container>
<ng-template #fullReleases>
    <latest-releases [releases]="latestReleases" [loading]="loading" [error]="error"></latest-releases>
    <section class="section container">
        <h2>Albums</h2>
        <div *ngIf="loading" class="loading" style="text-align:center;padding:16px;">Loading…</div>
        <div *ngIf="!loading && error" class="error" style="text-align:center;padding:16px;">
            <p>We couldn’t load releases right now.</p>
            <button class="button" (click)="reload()">Retry</button>
        </div>
        <div class="card-grid" *ngIf="!loading && !error && albums.length">
            <article class="glass card-bg" *ngFor="let s of albums; let i = index; trackBy: trackByReleaseId"
                style="padding:16px; position:relative; overflow:hidden;">
                <!-- every other card gets the 'reverse' class -->
                <div class="card-blur-bg" [ngClass]="{ 'reverse': i % 2 !== 0 }"
                    [ngStyle]="{ 'background-image': 'url(' + (s.coverArt || s.thumb_url || s.heroImage) + ')' }"
                    inViewAnimation>
                </div>
                <div class="cover-container">
                    <img class="cover" [src]="s.coverArt || s.thumb_url || s.heroImage" [alt]="s.title" loading="lazy" />
                    <button *ngIf="getYouTubeId(s)" class="play-button" (click)="togglePlay(s, $event, 'albums')" 
                            [class.playing]="isPlaying(s, 'albums')" 
                            [attr.aria-label]="isPlaying(s, 'albums') ? 'Pause' : 'Play'">
                        <svg *ngIf="!isPlaying(s, 'albums')" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                        <svg *ngIf="isPlaying(s, 'albums')" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
                        </svg>
                    </button>
                </div>
                <h3 style="margin:12px 0 4px;">{{s.title}}</h3>
                <p class="small">{{s.artist}} <span *ngIf="s.featuredArtists?.length">• feat.
                        {{s.featuredArtists.join(', ')}}</span>
                    <!-- <span *ngIf="s.featured" class="badge">Featured Album</span> -->
                </p>
                <div class="button-row-wrapper" [class.visible]="shouldShowButtons(s, 'albums')">
                    <div class="button-row">
                        <a *ngIf="s.preSaveLinks?.appleMusic || s.links?.appleMusic" class="button"
                            [href]="s.preSaveLinks?.appleMusic || s.links?.appleMusic" target="_blank">Apple</a>
                        <a *ngIf="s.preSaveLinks?.spotify || s.links?.spotify" class="button"
                            [href]="s.preSaveLinks?.spotify || s.links?.spotify" target="_blank">Spotify</a>
                        <a *ngIf="s.preSaveLinks?.youtubeMusic || s.links?.youtubeMusic" class="button"
                            [href]="s.preSaveLinks?.youtubeMusic || s.links?.youtubeMusic" target="_blank">YouTube</a>
                        <a *ngIf="s.preSaveLinks?.allPlatforms || s.links?.allPlatforms" class="button"
                            [href]="s.preSaveLinks?.allPlatforms || s.links?.allPlatforms" target="_blank">Other</a>
                    </div>
                    <div class="button-row-header" *ngIf="getYouTubeId(s)">
                        <button class="glass collapse-button" (click)="collapseLinks(s, 'albums', $event)" 
                                aria-label="Collapse links">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </article>
        </div>
    </section>

    <section class="section container">
        <h2>Singles</h2>
        <div *ngIf="loading" class="loading" style="text-align:center;padding:16px;">Loading…</div>
        <div *ngIf="!loading && error" class="error" style="text-align:center;padding:16px;">
            <p>We couldn’t load releases right now.</p>
            <button class="button" (click)="reload()">Retry</button>
        </div>
        <div class="card-grid" *ngIf="!loading && !error && releases.length">
            <article class="glass card-bg" *ngFor="let s of releases; let i = index; trackBy: trackByReleaseId"
                style="padding:16px; position:relative; overflow:hidden;">
                <!-- every 2nd card gets the 'reverse' class, but every 3rd card gets the 'normal' class, the first card gets nothing -->
                <div class="card-blur-bg" [ngClass]="{ 'reverse': i % 2 === 0, 'normal': i % 3 === 0 }"
                    [ngStyle]="{ 'background-image': 'url(' + (s.coverArt || s.thumb_url || s.heroImage) + ')' }"
                    inViewAnimation>
                </div>
                <div class="cover-container">
                    <img class="cover" [src]="s.coverArt || s.thumb_url || s.heroImage" [alt]="s.title" loading="lazy" />
                    <button *ngIf="getYouTubeId(s)" class="play-button" (click)="togglePlay(s, $event, 'singles')" 
                            [class.playing]="isPlaying(s, 'singles')" 
                            [attr.aria-label]="isPlaying(s, 'singles') ? 'Pause' : 'Play'">
                        <svg *ngIf="!isPlaying(s, 'singles')" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                        <svg *ngIf="isPlaying(s, 'singles')" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
                        </svg>
                    </button>
                </div>
                <h3 style="margin:12px 0 4px;">{{s.title}}</h3>
                <p class="small">{{s.artist}} <span *ngIf="s.featuredArtists?.length">• feat.
                        {{s.featuredArtists.join(', ')}}</span>
                </p>
                <div class="button-row-wrapper" [class.visible]="shouldShowButtons(s, 'singles')">
                    <div class="button-row">
                        <a *ngIf="s.preSaveLinks?.appleMusic || s.links?.appleMusic" class="button"
                            [href]="s.preSaveLinks?.appleMusic || s.links?.appleMusic" target="_blank">Apple</a>
                        <a *ngIf="s.preSaveLinks?.spotify || s.links?.spotify" class="button"
                            [href]="s.preSaveLinks?.spotify || s.links?.spotify" target="_blank">Spotify</a>
                        <a *ngIf="s.preSaveLinks?.youtubeMusic || s.links?.youtubeMusic" class="button"
                            [href]="s.preSaveLinks?.youtubeMusic || s.links?.youtubeMusic" target="_blank">YouTube</a>
                        <a *ngIf="s.preSaveLinks?.allPlatforms || s.links?.allPlatforms" class="button"
                            [href]="s.preSaveLinks?.allPlatforms || s.links?.allPlatforms" target="_blank">Other</a>
                    </div>
                    <div class="button-row-header" *ngIf="getYouTubeId(s)">
                        <button class="glass collapse-button" (click)="collapseLinks(s, 'singles', $event)" 
                                aria-label="Collapse links">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </article>
        </div>
    </section>
</ng-template>